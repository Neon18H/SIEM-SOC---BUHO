{% extends "base.html" %}

{% block breadcrumbs %}
<h5 class="mb-0">Publicación de Releases de Agente</h5>
{% endblock %}

{% block content %}
<div class="row g-4 mt-2">
  <div class="col-lg-4">
    <div class="card bg-dark-subtle border-secondary">
      <div class="card-body">
        <h6>Nuevo release</h6>
        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}
          {{ form.as_p }}
          <button class="btn btn-primary" type="submit">Guardar release</button>
        </form>
      </div>
    </div>
  </div>
  <div class="col-lg-8">
    <div class="card bg-dark-subtle border-secondary">
      <div class="card-body">
        <h6>Releases</h6>
        <table class="table table-dark table-striped">
          <thead><tr><th>Plataforma</th><th>Versión</th><th>SHA256</th><th>Activo</th><th></th></tr></thead>
          <tbody>
            {% for r in releases %}
            <tr>
              <td>{{ r.platform }}</td>
              <td>{{ r.version }}</td>
              <td><code>{{ r.sha256|default:'-' }}</code></td>
              <td>{% if r.is_active %}✅{% else %}-{% endif %}</td>
              <td class="d-flex gap-2">
                {% if not r.is_active %}
                <form method="post" action="{% url 'agent_downloads:release_activate' r.id %}">{% csrf_token %}<button class="btn btn-sm btn-outline-success">Activar</button></form>
                {% endif %}
                <form method="post" action="{% url 'agent_downloads:release_delete' r.id %}" onsubmit="return confirm('¿Eliminar release?')">{% csrf_token %}<button class="btn btn-sm btn-outline-danger">Eliminar</button></form>
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="5">No hay releases cargados.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
